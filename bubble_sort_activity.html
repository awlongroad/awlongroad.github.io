<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Sort Activity</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .instructions {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .instructions h2 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .instructions ol {
            margin-left: 20px;
            color: #555;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .cards-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .card {
            width: 80px;
            height: 110px;
            background: white;
            border: 3px solid #333;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            user-select: none;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .card.selected {
            background: #ffd700;
            border-color: #ff9800;
            transform: translateY(-10px);
        }

        .card.comparing {
            background: #ffeb3b;
            animation: pulse 0.5s ease-in-out;
        }

        .card.correct {
            background: #4caf50;
            color: white;
        }

        .card.locked {
            background: #90caf9;
            border-color: #1976d2;
            opacity: 0.7;
            position: relative;
        }

        .card.locked::after {
            content: 'ðŸ”’';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8em;
        }

        .suit {
            font-size: 1.5em;
            margin-top: 5px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            padding: 12px 30px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .compare-btn {
            background: #667eea;
            color: white;
        }

        .compare-btn:hover {
            background: #5568d3;
        }

        .swap-btn {
            background: #ff6b6b;
            color: white;
        }

        .swap-btn:hover {
            background: #ee5a52;
        }

        .no-swap-btn {
            background: #51cf66;
            color: white;
        }

        .no-swap-btn:hover {
            background: #40c057;
        }

        .reset-btn {
            background: #868e96;
            color: white;
        }

        .reset-btn:hover {
            background: #6c757d;
        }

        .info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .info h3 {
            color: #2e7d32;
            margin-bottom: 8px;
        }

        .info p {
            color: #555;
            font-size: 1.1em;
        }

        .comparison-log {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .comparison-log h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .log-entry {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            background: white;
            border-left: 4px solid #667eea;
        }

        .log-entry.swap {
            border-left-color: #ff6b6b;
        }

        .log-entry.no-swap {
            border-left-color: #51cf66;
        }

        .completion-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        .completion-message.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .pass-complete-message {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            display: none;
        }

        .pass-complete-message.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        .stats {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border: 2px solid #ffc107;
        }

        .stats h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .stats p {
            color: #856404;
            font-size: 1em;
            margin: 5px 0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .highlight-text {
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ´ Bubble Sort Activity</h1>
        <p style="text-align: center; color: #666; font-size: 1.1em; margin-bottom: 30px;">
            Learn how bubble sort works by sorting playing cards step-by-step
        </p>
        <div class="instructions">
            <h2>What is Bubble Sort?</h2>
            <p style="color: #555; line-height: 1.6; margin-bottom: 15px;">
                Bubble sort is a simple sorting algorithm that works by repeatedly comparing pairs of adjacent cards and swapping them if they're in the wrong order. The largest values "bubble up" to the end of the list, just like bubbles rising in water!
            </p>
            
            <h3 style="color: #667eea; margin-top: 20px;">How to Complete One Pass:</h3>
            <ol style="line-height: 1.8;">
                <li>Start at the beginning of the list</li>
                <li>Compare two cards next to each other</li>
                <li>If the left card is bigger than the right card, <strong>swap them</strong></li>
                <li>If they're already in the correct order, <strong>leave them</strong></li>
                <li>Move to the next pair and repeat until you reach the end</li>
            </ol>
            
            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #ff9800;">
                <p style="margin: 0; color: #e65100; font-weight: 600;">ðŸ“Œ Remember:</p>
                <p style="margin: 5px 0 0 0; color: #e65100;">
                    We're sorting from <strong>lowest to highest</strong>. Ace counts as 1 (the lowest card).
                </p>
            </div>

            <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #4caf50;">
                <p style="margin: 0; color: #2e7d32; font-weight: 600;">ðŸ’¡ Watch for:</p>
                <ul style="margin: 10px 0 0 20px; color: #2e7d32; line-height: 1.6;">
                    <li>Cards marked with ðŸ”’ are already in their final position</li>
                    <li>You'll need multiple passes to fully sort the cards</li>
                    <li>The activity will tell you when the sorting is complete!</li>
                </ul>
            </div>
        </div>

        <div class="info">
            <h3>What to Do:</h3>
            <p id="task-description">Click "Start Comparison" to begin sorting the cards</p>
        </div>

        <div class="stats">
            <h3>ðŸ“Š Your Progress</h3>
            <p><strong>Pass Number:</strong> <span id="current-pass">1</span></p>
            <p><strong>Comparisons This Pass:</strong> <span id="pass-comparisons">0</span> / <span id="max-comparisons">7</span></p>
            <p><strong>Swaps This Pass:</strong> <span id="pass-swaps">0</span></p>
            <p><strong>Total Comparisons:</strong> <span id="total-comparisons">0</span></p>
            <p><strong>Total Swaps:</strong> <span id="total-swaps">0</span></p>
        </div>

        <div class="cards-container" id="cards-container"></div>

        <div class="controls">
            <button class="compare-btn" id="compare-btn" onclick="startComparison()">Start Comparison</button>
            <button class="swap-btn" id="swap-btn" onclick="swapCards()" disabled>Swap Cards</button>
            <button class="no-swap-btn" id="no-swap-btn" onclick="noSwap()" disabled>No Swap Needed</button>
            <button class="reset-btn" onclick="resetActivity()">Reset Activity</button>
        </div>

        <div class="comparison-log">
            <h3>Comparison Log:</h3>
            <div id="log-container"></div>
        </div>

        <div class="pass-complete-message" id="pass-complete-message">
            <h2>âœ… Pass <span id="completed-pass-number">1</span> Complete!</h2>
            <p style="margin-top: 10px;">You made <span id="pass-swap-count">0</span> swap(s) during this pass.</p>
            <p style="margin-top: 10px; font-weight: 600;">The list is not fully sorted yet. Click "Continue to Next Pass" to proceed.</p>
            <button class="compare-btn" style="margin-top: 15px; font-size: 1.1em;" onclick="startNextPass()">Continue to Next Pass</button>
        </div>

        <div class="completion-message" id="completion-message">
            <h2>ðŸŽ‰ Brilliant! The list is now fully sorted!</h2>
            <p style="margin-top: 10px;">You completed the bubble sort in <span id="total-passes">0</span> pass(es).</p>
            <p style="margin-top: 5px;">Total comparisons: <span id="final-comparison-count">0</span></p>
            <p style="margin-top: 5px;">Total swaps: <span id="final-swap-count">0</span></p>
            <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                ðŸ’¡ The optimizations reduced comparisons by avoiding already-sorted elements and detecting early completion!
            </p>
            <p style="margin-top: 10px;">Click "Reset Activity" to try again or practise more.</p>
        </div>
    </div>

    <script>
        // Initial card values (Ace = 1, then 2-8)
        const initialCards = [
            { value: 6, display: '6' },
            { value: 4, display: '4' },
            { value: 5, display: '5' },
            { value: 2, display: '2' },
            { value: 8, display: '8' },
            { value: 1, display: 'A' },
            { value: 7, display: '7' },
            { value: 3, display: '3' }
        ];

        let cards = [...initialCards];
        let currentIndex = 0;
        let passSwapCount = 0;
        let totalSwapCount = 0;
        let currentPass = 1;
        let comparisons = [];
        let maxComparisonIndex = cards.length - 1; // Reduces by 1 each pass
        let totalComparisons = 0;
        let passComparisons = 0;

        function isSorted() {
            for (let i = 0; i < cards.length - 1; i++) {
                if (cards[i].value > cards[i + 1].value) {
                    return false;
                }
            }
            return true;
        }

        function updateStats() {
            document.getElementById('current-pass').textContent = currentPass;
            document.getElementById('pass-swaps').textContent = passSwapCount;
            document.getElementById('total-swaps').textContent = totalSwapCount;
            document.getElementById('pass-comparisons').textContent = passComparisons;
            document.getElementById('max-comparisons').textContent = maxComparisonIndex;
            document.getElementById('total-comparisons').textContent = totalComparisons;
        }

        function initializeCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                // Mark cards that are already in their correct position (past maxComparisonIndex)
                if (index > maxComparisonIndex) {
                    cardElement.classList.add('locked');
                }
                
                cardElement.innerHTML = `
                    ${card.display}
                    <span class="suit">â™ </span>
                `;
                cardElement.dataset.index = index;
                container.appendChild(cardElement);
            });
        }

        function startComparison() {
            if (currentIndex >= maxComparisonIndex) {
                return;
            }

            // Increment comparison counters
            totalComparisons++;
            passComparisons++;
            updateStats();

            // Highlight the two cards being compared
            const cardElements = document.querySelectorAll('.card');
            cardElements[currentIndex].classList.add('comparing');
            cardElements[currentIndex + 1].classList.add('comparing');

            // Update task description
            const card1 = cards[currentIndex].display;
            const card2 = cards[currentIndex + 1].display;
            document.getElementById('task-description').innerHTML = 
                `Compare <span class="highlight-text">${card1}</span> and <span class="highlight-text">${card2}</span>. Should they be swapped?`;

            // Enable swap/no-swap buttons, disable compare button
            document.getElementById('swap-btn').disabled = false;
            document.getElementById('no-swap-btn').disabled = false;
            document.getElementById('compare-btn').disabled = true;
        }

        function swapCards() {
            const card1 = cards[currentIndex];
            const card2 = cards[currentIndex + 1];

            // Check if swap is correct
            const shouldSwap = card1.value > card2.value;

            if (shouldSwap) {
                // Correct swap
                [cards[currentIndex], cards[currentIndex + 1]] = [cards[currentIndex + 1], cards[currentIndex]];
                passSwapCount++;
                totalSwapCount++;
                updateStats();
                
                addLogEntry(`Pass ${currentPass}, Comparison ${currentIndex + 1}: ${card1.display} > ${card2.display} â†’ Swapped âœ“`, 'swap');
                
                // Animate swap
                animateSwap();
            } else {
                // Incorrect swap
                addLogEntry(`Pass ${currentPass}, Comparison ${currentIndex + 1}: ${card1.display} and ${card2.display} â†’ Incorrect! No swap needed âœ—`, 'no-swap');
                alert('Actually, these cards don\'t need to be swapped! Try again.');
                removeHighlights();
                enableCompareButton();
                return;
            }

            moveToNext();
        }

        function noSwap() {
            const card1 = cards[currentIndex];
            const card2 = cards[currentIndex + 1];

            // Check if no-swap is correct
            const shouldSwap = card1.value > card2.value;

            if (!shouldSwap) {
                // Correct no-swap
                addLogEntry(`Pass ${currentPass}, Comparison ${currentIndex + 1}: ${card1.display} â‰¤ ${card2.display} â†’ No swap needed âœ“`, 'no-swap');
            } else {
                // Incorrect no-swap
                addLogEntry(`Pass ${currentPass}, Comparison ${currentIndex + 1}: ${card1.display} and ${card2.display} â†’ Incorrect! Swap needed âœ—`, 'swap');
                alert('Actually, these cards need to be swapped! Try again.');
                removeHighlights();
                enableCompareButton();
                return;
            }

            moveToNext();
        }

        function animateSwap() {
            initializeCards();
        }

        function moveToNext() {
            removeHighlights();
            currentIndex++;

            if (currentIndex >= maxComparisonIndex) {
                // Completed one pass
                completePass();
            } else {
                enableCompareButton();
                document.getElementById('task-description').innerHTML = 
                    'Click "Start Comparison" to compare the next pair of cards';
            }
        }

        function removeHighlights() {
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('comparing', 'selected');
            });
        }

        function enableCompareButton() {
            document.getElementById('compare-btn').disabled = false;
            document.getElementById('swap-btn').disabled = true;
            document.getElementById('no-swap-btn').disabled = true;
        }

        function completePass() {
            removeHighlights();
            
            document.getElementById('compare-btn').disabled = true;
            document.getElementById('swap-btn').disabled = true;
            document.getElementById('no-swap-btn').disabled = true;

            // Check if no swaps were made this pass (early completion optimization)
            if (passSwapCount === 0) {
                // Array is already sorted - no swaps needed
                document.getElementById('task-description').innerHTML = 
                    'âœ… No swaps needed! The list is already sorted!';
                
                document.getElementById('total-passes').textContent = currentPass;
                document.getElementById('final-swap-count').textContent = totalSwapCount;
                document.getElementById('final-comparison-count').textContent = totalComparisons;
                document.getElementById('completion-message').classList.add('show');

                // Add note about early completion optimization
                addLogEntry(`ðŸŽ¯ Optimization: Pass ${currentPass} had 0 swaps - list is sorted!`, 'no-swap');

                // Highlight all cards as correct
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.add('correct');
                    card.classList.remove('locked');
                });
            }
            // Check if the array is fully sorted (should not be needed if no swaps optimization works)
            else if (isSorted()) {
                // Fully sorted - show completion message
                document.getElementById('task-description').innerHTML = 
                    'âœ… The list is now fully sorted!';
                
                document.getElementById('total-passes').textContent = currentPass;
                document.getElementById('final-swap-count').textContent = totalSwapCount;
                document.getElementById('final-comparison-count').textContent = totalComparisons;
                document.getElementById('completion-message').classList.add('show');

                // Highlight all cards as correct
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.add('correct');
                    card.classList.remove('locked');
                });
            } else {
                // Not sorted yet - show pass complete message
                document.getElementById('task-description').innerHTML = 
                    `âœ… Pass ${currentPass} completed! The list needs more sorting.`;
                
                document.getElementById('completed-pass-number').textContent = currentPass;
                document.getElementById('pass-swap-count').textContent = passSwapCount;
                document.getElementById('pass-complete-message').classList.add('show');
                
                // Add optimization note
                const reductionNote = maxComparisonIndex < cards.length - 1 ? 
                    ` (${cards.length - maxComparisonIndex} element(s) already in correct position)` : '';
                addLogEntry(`âœ“ Pass ${currentPass} complete: ${passComparisons} comparison(s), ${passSwapCount} swap(s)${reductionNote}`, 'no-swap');
            }
        }

        function startNextPass() {
            // Hide the pass complete message
            document.getElementById('pass-complete-message').classList.remove('show');
            
            // Reset for next pass
            currentPass++;
            currentIndex = 0;
            passSwapCount = 0;
            passComparisons = 0;
            maxComparisonIndex--; // Optimization: reduce by 1 each pass (largest element is now in place)
            updateStats();
            
            // Add separator in log with optimization note
            const comparisonsThisPass = maxComparisonIndex;
            addLogEntry(`--- Starting Pass ${currentPass} (${comparisonsThisPass} comparison${comparisonsThisPass !== 1 ? 's' : ''}) ---`, 'no-swap');
            
            document.getElementById('task-description').innerHTML = 
                `Starting Pass ${currentPass}. Click "Start Comparison" to continue sorting.`;
            
            // Re-render cards to show newly locked elements
            initializeCards();
            
            enableCompareButton();
        }

        function addLogEntry(message, type) {
            const logContainer = document.getElementById('log-container');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function resetActivity() {
            cards = [...initialCards];
            currentIndex = 0;
            passSwapCount = 0;
            totalSwapCount = 0;
            currentPass = 1;
            comparisons = [];
            maxComparisonIndex = cards.length - 1; // Reset optimization
            totalComparisons = 0;
            passComparisons = 0;

            initializeCards();
            updateStats();
            
            document.getElementById('log-container').innerHTML = '';
            document.getElementById('task-description').innerHTML = 
                'Click "Start Comparison" to begin the bubble sort pass';
            
            document.getElementById('completion-message').classList.remove('show');
            document.getElementById('pass-complete-message').classList.remove('show');
            
            enableCompareButton();
        }

        // Initialize on load
        initializeCards();
        updateStats();
    </script>
</body>
</html>
